var adminModule=angular.module("admin",["sharedModule"]);adminModule.config(["$stateProvider",function(e){e.state("main",{url:"/",views:{"":{templateUrl:"/app/shared/views/main.view.html",controller:"sharedMainViewController"},"content-container@main":{templateUrl:"/app/shared/views/content-container.view.html",controller:"sharedDashboardContentContainerController"},"toolbar@main":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"subheader@main":{templateUrl:"/app/shared/templates/subheaders/dashboard-subheader.template.html"},"content@main":{templateUrl:"/app/shared/templates/content/dashboard-content.template.html"}}}).state("main.settings",{url:"settings",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"settingsContentContainerController"},"toolbar@main.settings":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.settings":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"subheader@main.settings":{templateUrl:"/app/components/admin/templates/subheaders/settings-subheader.template.html"},"content@main.settings":{templateUrl:"/app/components/admin/templates/content/settings-content.template.html"}}}).state("main.tracker",{url:"tracker",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"trackerContentContainerController"},"toolbar@main.tracker":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.tracker":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"subheader@main.tracker":{templateUrl:"/app/shared/templates/subheaders/tracker-subheader.template.html"},"content@main.tracker":{templateUrl:"/app/shared/templates/content/tracker-content.template.html"}}}).state("main.notifications",{url:"notifications",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"sharedNotificationsContentContainerController"},"toolbar@main.notifications":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.notifications":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"content@main.notifications":{templateUrl:"/app/shared/templates/content/notifications-content.template.html"}}}).state("main.upload",{url:"upload",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"uploadContentContainerController"},"toolbar@main.upload":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.upload":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"content@main.upload":{templateUrl:"/app/components/admin/templates/content/upload-content.template.html"}}}).state("main.sheets",{url:"sheets",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"sheetsContentContainerController"},"toolbar@main.sheets":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.sheets":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"subheader@main.sheets":{templateUrl:"/app/components/admin/templates/subheaders/sheets-subheader.template.html"},"content@main.sheets":{templateUrl:"/app/components/admin/templates/content/sheets-content.template.html"}}}).state("main.task",{url:"task/{taskID}",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"taskContentContainerController"},"toolbar@main.task":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.task":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"content@main.task":{templateUrl:"/app/shared/templates/content/task-content.template.html"}}})}]),adminModule.controller("mainViewController",["$scope","$state","$mdDialog","$mdSidenav","$mdToast","User","Preloader","Notification",function(e,t,a,n,s,o,r,i){e.toggleSidenav=function(e){n(e).toggle()},e.menu={},e.menu["static"]=[{state:"main",icon:"mdi-view-dashboard",label:"Dashboard"},{state:"main.sheets",icon:"mdi-file-excel",label:"Sheets"},{state:"main.tracker",icon:"mdi-view-list",label:"Tracker"},{state:"main.notifications",icon:"mdi-bell",label:"Notifications"},{state:"main.settings",icon:"mdi-settings",label:"Settings"}],e.logout=function(){o.logout().success(function(){window.location.href="/"})},e.changePassword=function(){a.show({controller:"changePasswordDialogController",templateUrl:"/app/shared/templates/dialogs/change-password-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){s.show(s.simple().content("Password changed.").position("bottom right").hideDelay(3e3))})};var l=function(){o.check().success(function(t){c(t),e.user=t})},c=function(a){return angular.forEach(a.unread_notifications,function(a){a.first_letter=a.data.sender.name.charAt(0).toUpperCase(),a.sender=a.data.sender.name,a.created_at=new Date(a.created_at),"App\\Notifications\\TaskCreated"==a.type?(a.message="created a new task.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\SpreadsheetCreated"==a.type?(a.message="created a new sheet.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.sheet",{sheetID:a.data.attachment.id})})}):"App\\Notifications\\TaskAssignedToDesigner"==a.type?(a.message="assigned a task for "+a.data.attachment.designer.name+".",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\DesignerTaskStart"==a.type?(a.message="started to work on "+a.data.attachment.task.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\TaskDeleted"==a.type?(a.message="deleted a task.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\DesignerTaskDecline"==a.type?(a.message="declined to work on "+a.data.attachment.task.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\ForQC"==a.type&&(a.message="submitted a task for quality control.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})})}),a};e.markAsRead=function(t){i.markAsRead(t).success(function(t){c(t),e.user=t})},e.markAllAsRead=function(){i.markAllAsRead().success(function(t){c(t),e.user=t})},o.check().success(function(t){c(t),e.user=t;var a=new Pusher("7c041c12ae347877d32d",{encrypted:!0}),n={};n.admin=a.subscribe("admin"),n.user=a.subscribe("user."+e.user.id),n.user.bindings=[n.user.bind("App\\Events\\PusherTaskCreated",function(e){l();var t=e.sender.name+" created a new task.";r.newNotification(t)}),n.user.bind("App\\Events\\PusherSpreadsheetCreated",function(e){l();var t=e.sender.name+" created a new sheet.";r.newNotification(t)}),n.user.bind("App\\Events\\PusherTaskAssignedToDesigner",function(e){l();var t=e.sender.name+" assigned a task for "+e.data.name+".";r.newNotification(t)}),n.user.bind("App\\Events\\PusherDesignerTaskStart",function(e){l();var t=e.sender.name+" started to work on "+e.data.file_name+".";r.newNotification(t)}),n.user.bind("App\\Events\\PusherTaskDeleted",function(e){l();var t=e.sender.name+" deleted a task.";r.newNotification(t)}),n.user.bind("App\\Events\\PusherDesignerTaskDecline",function(e){l();var t=e.sender.name+" declined to work on "+e.data.file_name+".";r.newNotification(t)}),n.user.bind("App\\Events\\PusherForQC",function(e){l();var t=e.sender.name+" submitted a task for quality control.";r.newNotification(t)})]})}]),adminModule.controller("settingsContentContainerController",["$scope","$filter","$timeout","$mdDialog","$mdToast","$mdBottomSheet","$mdMedia","Preloader","Setting","User",function(e,t,a,n,s,o,r,i,l,c){e.toolbar={},e.toolbar.childState="Settings",e.toolbar.getItems=function(a){e.showInactive=!0;var n=a?t("filter")(e.toolbar.items,a):e.toolbar.items;return n},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.type.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.type.busy=!1,e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.showInactive=!1,e.searched&&(e.type.page=1,e.type.no_matches=!1,e.type.items=[],e.searched=!1)},e.searchUserInput=function(){e.type.busy=!0,e.isLoading=!0,e.type.show=!1,e.query={},e.query.searchText=e.toolbar.searchText,e.query.withTrashed=!0,"Designers"==e.subheader.currentNavItem?e.query.where=[{label:"role",condition:"=",value:"designer"}]:"Quality Control"==e.subheader.currentNavItem&&(e.query.where=[{label:"role",condition:"=",value:"quality_control"}]),l.search(e.subheader.currentNavItem,e.query).success(function(t){e.toolbar.items=[],t.length?(angular.forEach(t,function(e){m(e)}),e.type.items=t):(e.type.items=[],e.type.no_matches=!0),e.searched=!0,e.type.show=!0,e.isLoading=!1}).error(function(e){i.error()})},e.fab={},e.fab.icon="mdi-plus";var u=function(t){var a="create",s=l.settingController(a,t),o=l.settingDialogTemplate(a,t);e.fab.label=t,e.fab.action=function(){n.show({controller:s,templateUrl:"/app/components/admin/templates/dialogs/"+o,parent:angular.element(document.body),fullscreen:!0}).then(function(){e.type.busy=!0,e.isLoading=!0,e.type.show=!1,l.fabCreateSuccessMessage(t).then(function(){e.init(e.subheader.currentNavItem)})},function(){})},e.toolbar.items=[],e.init(t),"Categories"==t||"Clients"==t?e.item_menu=[{label:"Edit",icon:"mdi-pencil",action:function(t){var a="edit",s=l.settingController(a,e.subheader.currentNavItem),o=l.settingDialogTemplate(a,e.subheader.currentNavItem);i.set(t),n.show({controller:s,templateUrl:"/app/components/admin/templates/dialogs/"+o,parent:angular.element(document.body),fullscreen:!0}).then(function(){e.type.busy=!0,e.isLoading=!0,e.type.show=!1;var a=t.name+" has been updated.";i.notify(a).then(function(){e.init(e.subheader.currentNavItem)})},function(){})}},{label:"Delete",icon:"mdi-delete",action:function(t){var a=n.confirm().title("Delete").textContent("Delete "+t.name+"?").ariaLabel("Delete").ok("Delete").cancel("Cancel");n.show(a).then(function(){e.type.busy=!0,e.isLoading=!0,e.type.show=!1,l["delete"](e.subheader.currentNavItem,t).success(function(){var a=t.name+" has been removed.";i.notify(a).then(function(){e.init(e.subheader.currentNavItem)})}).error(function(){i.error()})},function(){})}}]:e.item_menu=[{label:"Update Info",icon:"mdi-pencil",action:function(t){i.set(t),n.show({controller:"editUsersDialogController",templateUrl:"/app/components/admin/templates/dialogs/edit-users-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.type.busy=!0,e.isLoading=!0,e.type.show=!1;var a=t.name+"'s account has been updated.";i.notify(a).then(function(){e.init(e.subheader.currentNavItem)})},function(){})}},{label:"Reset Password",icon:"mdi-key-minus",action:function(e){var t=n.confirm().title("Reset password").textContent("Reset "+e.name+"'s password?").ariaLabel("Reset password").ok("Reset").cancel("Cancel");n.show(t).then(function(){c.resetPassword([e]).success(function(){var t=e.name+'\'s password has been reset to "!welcome10".';i.notify(t)}).error(function(){i.error()})},function(){})}},{label:"Disable Account",icon:"mdi-account-remove",action:function(t){var a=n.confirm().title("Disable account").textContent("Disable "+t.name+"'s account?").ariaLabel("Disable account").ok("Disable").cancel("Cancel");n.show(a).then(function(){e.type.busy=!0,e.isLoading=!0,e.type.show=!1,c["delete"](t).success(function(){var a=t.name+"'s account has been disabled.";i.notify(a).then(function(){e.init(e.subheader.currentNavItem)})}).error(function(){i.error()})},function(){})}}]};e.subheader={},e.subheader.show=!0,e.subheader.navs=[{label:"Categories",action:function(){u(this.label)}},{label:"Clients",action:function(){u(this.label)}},{label:"Designers",action:function(){u(this.label)}},{label:"Quality Control",action:function(){u(this.label)}}],e.subheader.sort=[{label:"Name",type:"name",sortReverse:!1},{label:"Recently added",type:"created_at",sortReverse:!1}],e.subheader.refresh=function(){e.isLoading=!0,e.type.show=!1,e.init(e.subheader.currentNavItem)},e.subheader.toggleActive=function(){e.showInactive=!e.showInactive},e.subheader.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.showOptions=function(t){t.deleted_at||(t.item_menu=e.item_menu,i.set(t),r("xs")||r("sm")?(e.fab.show=!1,o.show({templateUrl:"/app/shared/templates/bottom-sheets/item-actions-bottom-sheet.template.html",controller:"itemActionsBottomSheetController"}).then(function(a){e.item_menu[a].action(t)},function(){e.fab.show=!0})):n.show({controller:"itemActionsDialogController",templateUrl:"/app/shared/templates/dialogs/item-actions-dialog.template.html",parent:angular.element(document.body),clickOutsideToClose:!0}).then(function(a){e.item_menu[a].action(t)},function(){}))},e.rightSidenav={},e.rightSidenav.show=!1;var m=function(t){t.first_letter=t.name.charAt(0).toUpperCase(),t.created_at=new Date(t.created_at),t.deleted_at=t.deleted_at?new Date(t.deleted_at):null;var a={};a.display=t.name,e.toolbar.items.push(a)};e.init=function(t){e.type={},e.type.items=[],e.searched&&(e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.type.page=1,e.type.no_matches=!1,e.searched=!1),e.type.page=2,l.paginate(t).success(function(a){e.type.details=a,e.type.items=a.data,e.type.show=!0,e.fab.show=!0,e.showInactive=!1,a.data.length&&angular.forEach(a.data,function(e){m(e)}),e.type.paginateLoad=function(){return e.type.busy||e.type.page>e.type.details.last_page?void(e.isLoading=!1):(e.type.busy=!0,e.isLoading=!0,void l.paginate(t,e.type.page).success(function(t){e.type.page++,angular.forEach(t.data,function(t,a){m(t),e.type.items.push(t)}),e.type.busy=!1,e.isLoading=!1}))}})},e.subheader.currentNavItem=e.subheader.navs[0].label,e.fab.label=e.subheader.navs[0].label,u(e.subheader.currentNavItem)}]),adminModule.controller("createDesignersDialogController",["$scope","$mdDialog","Preloader","User",function(e,t,a,n){e.user={},e.user.role="designer",e.label="Designer",e.busy=!1,e.duplicate=!1,e.showHints=!0,e.checkDuplicate=function(){n.checkEmail(e.user).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.showHints=!1,e.userForm.$invalid?void angular.forEach(e.userForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.user.password==e.user.confirm&&(e.busy=!0,n.store(e.user).success(function(t){return t?void(e.busy=!1):void a.stop()}).error(function(){a.error()})))}}]),adminModule.controller("createQualityControlDialogController",["$scope","$mdDialog","Preloader","User",function(e,t,a,n){e.user={},e.user.role="quality_control",e.label="Quality Control",e.busy=!1,e.duplicate=!1,e.showHints=!0,e.checkDuplicate=function(){n.checkEmail(e.user).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.showHints=!1,e.userForm.$invalid?void angular.forEach(e.userForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.user.password==e.user.confirm&&(e.busy=!0,n.store(e.user).success(function(t){return t?void(e.busy=!1):void a.stop()}).error(function(){a.error()})))}}]),adminModule.controller("editUsersDialogController",["$scope","$mdDialog","Preloader","User",function(e,t,a,n){n.show(a.get().id).success(function(t){e.user=t,e.label=t.name}),e.busy=!1,e.duplicate=!1,e.showHints=!0,e.roles=[{label:"Designer",value:"designer"},{label:"Quality Control",value:"quality_control"}],e.checkDuplicate=function(){n.checkEmail(e.user).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.showHints=!1,e.userForm.$invalid?void angular.forEach(e.userForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.user.password==e.user.confirm&&(e.busy=!0,n.update(e.user.id,e.user).success(function(t){return"boolean"==typeof t?void(e.busy=!1):void a.stop(t)}).error(function(){a.error()})))}}]);