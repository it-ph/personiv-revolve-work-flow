var designerModule=angular.module("designer",["sharedModule"]);designerModule.config(["$stateProvider",function(e){e.state("main",{url:"/",views:{"":{templateUrl:"/app/shared/views/main.view.html",controller:"mainViewController"},"content-container@main":{templateUrl:"/app/shared/views/content-container.view.html",controller:"sharedDashboardContentContainerController"},"toolbar@main":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"subheader@main":{templateUrl:"/app/shared/templates/subheaders/dashboard-subheader.template.html"},"content@main":{templateUrl:"/app/shared/templates/content/dashboard-content.template.html"}}}).state("main.tracker",{url:"tracker",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"trackerContentContainerController"},"toolbar@main.tracker":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.tracker":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"subheader@main.tracker":{templateUrl:"/app/shared/templates/subheaders/tracker-subheader.template.html"},"content@main.tracker":{templateUrl:"/app/shared/templates/content/tracker-content.template.html"}}}).state("main.notifications",{url:"notifications",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"sharedNotificationsContentContainerController"},"toolbar@main.notifications":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.notifications":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"content@main.notifications":{templateUrl:"/app/shared/templates/content/notifications-content.template.html"}}}).state("main.task",{url:"task/{taskID}",views:{"content-container":{templateUrl:"/app/shared/views/content-container.view.html",controller:"taskContentContainerController"},"toolbar@main.task":{templateUrl:"/app/shared/templates/toolbar.template.html"},"left-sidenav@main.task":{templateUrl:"/app/shared/templates/sidenavs/main-left-sidenav.template.html"},"content@main.task":{templateUrl:"/app/shared/templates/content/task-content.template.html"}}})}]),designerModule.controller("mainViewController",["$scope","$state","$mdDialog","$mdSidenav","$mdToast","User","Preloader","Notification",function(e,t,a,n,r,s,o,i){e.toggleSidenav=function(e){n(e).toggle()},e.menu={},e.menu["static"]=[{state:"main",icon:"mdi-view-dashboard",label:"Dashboard"},{state:"main.tracker",icon:"mdi-view-list",label:"Tracker"},{state:"main.notifications",icon:"mdi-bell",label:"Notifications"}],e.logout=function(){s.logout().success(function(){window.location.href="/"})},e.changePassword=function(){a.show({controller:"changePasswordDialogController",templateUrl:"/app/shared/templates/dialogs/change-password-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){r.show(r.simple().content("Password changed.").position("bottom right").hideDelay(3e3))})};var l=function(){s.check().success(function(t){c(t),e.user=t})},c=function(a){return angular.forEach(a.unread_notifications,function(a){a.first_letter=a.data.sender.name.charAt(0).toUpperCase(),a.sender=a.data.sender.name,a.created_at=new Date(a.created_at),"App\\Notifications\\NotifyDesignerForNewTask"==a.type?(a.message="assigned a task for you.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\NotifyDesignerForCompleteTask"==a.type?(a.message="marked your task "+a.data.attachment.file_name+" as complete.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\NotifyComment"==a.type?(a.message="commented on your task on "+a.data.attachment.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\NotifyDesignerForTaskRework"==a.type&&(a.message="marked your task "+a.data.attachment.file_name+" as rework.",a.action=function(n){i.markAsRead(n).success(function(n){c(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})})}),a};e.markAsRead=function(t){i.markAsRead(t).success(function(t){c(t),e.user=t})},e.markAllAsRead=function(){i.markAllAsRead().success(function(t){c(t),e.user=t})},s.check().success(function(t){c(t),e.user=t;var a=new Pusher("7c041c12ae347877d32d",{encrypted:!0}),n={};n.designer=a.subscribe("designer"),n.user=a.subscribe("user."+e.user.id),n.user.bindings=[n.user.bind("App\\Events\\PusherNotifyDesignerForNewTask",function(t){l();var a=t.sender.name+" assigned a task for you.";o.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherNotifyDesignerForCompleteTask",function(t){l();var a=t.sender.name+" marked your task "+t.data.file_name+" as complete.";o.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherNotifyComment",function(t){l();var a=t.sender.name+" commented on your task on "+t.data.file_name+".";o.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherNotifyDesignerForTaskRework",function(t){l();var a=t.sender.name+" marked your task "+t.data.file_name+" as rework.";o.newNotification(a),e.$broadcast("refresh")})]})}]),designerModule.controller("trackerContentContainerController",["$scope","$state","$filter","$timeout","$mdDialog","$mdToast","$mdBottomSheet","$mdMedia","Preloader","Category","Client","DesignerAssigned","User",function(e,t,a,n,r,s,o,i,l,c,d,u,h){e.toolbar={},e.toolbar.childState="Tracker",e.toolbar.getItems=function(t){e.showInactive=!0;var n=t?a("filter")(e.toolbar.items,t):e.toolbar.items;return n},e.toolbar.searchAll=!0,e.$on("refresh",function(){e.init(e.subheader.current.request)}),e.showSearchBar=function(){e.task.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.task.busy=!1,e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.showInactive=!1,e.searched&&(e.task.page=1,e.task.no_matches=!1,e.task.items=[],e.searched=!1,e.init(e.subheader.current.request))},e.searchUserInput=function(){e.isLoading=!0,e.task.show=!1,e.searched=!0,e.init(e.subheader.current.request,!0)};var m=function(t){e.subheader.current=t,e.toolbar.items=[],e.init(e.subheader.current.request)};e.fab={},e.subheader={},e.subheader.show=!0,e.subheader.navs=[{label:"Pending",request:{withTask:[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0}],where:[{label:"status",condition:"=",value:"pending"}],paginate:20},action:function(e){m(e)},menu:[{label:"Batch start",icon:"mdi-timer",action:function(){e.selectMultiple=!0,e.fab.label="Start",e.fab.icon=this.icon,e.fab.show=!0,e.fab.action=function(){l.set(e.task.items),r.show({controller:"batchStartTaskDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectMultiple=!1,e.fab.show=!1,e.subheader.refresh()})}}}]},{label:"In Progress",request:{withTask:[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1},{relation:"reworks",withTrashed:!1,"with":[{relation:"designer",withTrashed:!0},{relation:"quality_control",withTrashed:!0}]}],where:[{label:"status",condition:"=",value:"in_progress"}],paginate:20},action:function(e){m(e)},menu:[{label:"Batch For QC",icon:"mdi-timer-off",action:function(){e.selectForQC=!0,e.fab.label="For QC",e.fab.icon=this.icon,e.fab.show=!0,e.fab.action=function(){l.set(e.task.items),r.show({controller:"batchForQCDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectForQC=!1,e.fab.show=!1,e.subheader.refresh()})}}},{label:"Batch For QC Revised",icon:"mdi-repeat-off",action:function(){e.selectRework=!0,e.fab.label="For QC Revised",e.fab.icon=this.icon,e.fab.show=!0,e.fab.action=function(){l.set(e.task.items),r.show({controller:"batchForQCRevisedDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectRework=!1,e.fab.show=!1,e.subheader.refresh()})}}}]},{label:"For QC",request:{withTask:[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"quality_control_assigned",withTrashed:!1}],where:[{label:"status",condition:"=",value:"for_qc"}],paginate:20},action:function(e){m(e)}},{label:"Rework",request:{withTask:[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1},{relation:"reworks",withTrashed:!1,"with":[{relation:"designer",withTrashed:!0},{relation:"quality_control",withTrashed:!0}]}],where:[{label:"status",condition:"=",value:"rework"}],paginate:20},action:function(e){m(e)},menu:[{label:"Batch revise",icon:"mdi-timer",action:function(){e.selectMultiple=!0,e.fab.label="Revise",e.fab.icon=this.icon,e.fab.show=!0,e.fab.action=function(){l.set(e.task.items),r.show({controller:"batchReviseTaskDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectMultiple=!1,e.fab.show=!1,e.subheader.refresh()})}}}]},{label:"Complete",request:{withTask:[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1}],where:[{label:"status",condition:"=",value:"complete"}],paginate:20},action:function(e){m(e)}}],e.subheader.sort=[{label:"File Name",type:"file_name",sortReverse:!1},{label:"Category",type:"category",sortReverse:!1},{label:"Delivery Date",type:"delivery_date",sortReverse:!1},{label:"Live Date",type:"live_date",sortReverse:!1},{label:"Recently added",type:"created_at",sortReverse:!1}],e.subheader.mark={},e.subheader.mark.all=!1,e.subheader.mark.icon="mdi-checkbox-blank-outline",e.subheader.mark.label="Check all",e.subheader.toggleMark=function(){e.subheader.mark.all=!e.subheader.mark.all,e.subheader.mark.icon=e.subheader.mark.all?"mdi-checkbox-marked":"mdi-checkbox-blank-outline",e.subheader.mark.label=e.subheader.mark.all?"Uncheck all":"Check all",angular.forEach(e.task.items,function(t){t.include=e.subheader.mark.all})},e.subheader.cancelSelectMultiple=function(){e.selectMultiple=!1,e.selectForQC=!1,e.selectRework=!1,e.fab.show=!1,e.subheader.mark.all=!1,e.subheader.mark.icon="mdi-checkbox-blank-outline",e.subheader.mark.label="Check all",angular.forEach(e.task.items,function(e){e.include=!1})},e.subheader.refresh=function(){e.isLoading=!0,e.task.show=!1,e.init(e.subheader.current.request)},e.subheader.toggleActive=function(){e.showInactive=!e.showInactive},e.subheader.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.subheader.setCategoryFilter=function(t){return e.categoryFilter==t?e.categoryFilter="":void(e.categoryFilter=t)},e.subheader.setClientFilter=function(t){return e.clientFilter==t?e.clientFilter="":void(e.clientFilter=t)},e.rightSidenav={},e.rightSidenav.show=!1;var f=function(t){t.first_letter=t.file_name.charAt(0).toUpperCase(),t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),t.delivery_date=new Date(t.delivery_date),t.live_date=new Date(t.live_date),t.category=t.category.name,t.client=t.client.name;var a={};a.display=t.file_name,e.toolbar.items.push(a),e.task.items.push(t)};e.init=function(t,a){e.selectMultiple=!1,e.selectForQC=!1,e.selectRework=!1,c.index().success(function(t){e.categories=t}),d.index().success(function(t){e.clients=t}),e.task={},e.task.items=[],e.toolbar.items=[],a?t.searchText=e.toolbar.searchText:(e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.task.page=1,e.task.no_matches=!1,e.searched=!1,t.searchText=null),e.task.page=2,u.paginate(t).success(function(a){return a?(e.task.details=a,e.task.show=!0,e.showInactive=!1,a.data.length&&angular.forEach(a.data,function(e){e.task&&f(e.task)}),void(e.task.paginateLoad=function(){return e.task.busy||e.task.page>e.task.details.last_page?void(e.isLoading=!1):(e.task.busy=!0,e.isLoading=!0,void u.paginate(t,e.task.page).success(function(t){e.task.page++,angular.forEach(t.data,function(e,t){e.task&&f(e.task)}),e.task.busy=!1,e.isLoading=!1}))})):void(e.task.show=!0)})},e.subheader.currentNavItem=e.subheader.navs[0].label,m(e.subheader.navs[0])}]),designerModule.controller("batchForQCDialogController",["$scope","$mdDialog","Preloader","DesignerAssigned",function(e,t,a,n){e.tasks=a.get(),e.busy=!1,e.label="Batch For QC",e.action="For QC",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),n.forQC(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),designerModule.controller("batchForQCRevisedDialogController",["$scope","$mdDialog","Preloader","Rework",function(e,t,a,n){e.tasks=a.get(),e.busy=!1,e.label="Batch For QC Revised",e.action="For QC Revised",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),n.forQC(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),designerModule.controller("batchReviseTaskDialogController",["$scope","$mdDialog","Preloader","Rework",function(e,t,a,n){e.tasks=a.get(),e.busy=!1,e.label="Batch Start Revision",e.action="Start Revision",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),n.revise(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),designerModule.controller("batchStartTaskDialogController",["$scope","$mdDialog","Preloader","DesignerAssigned",function(e,t,a,n){e.tasks=a.get(),e.busy=!1,e.label="Batch Start",e.action="Start",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),n.start(t).success(function(){a.stop()}).error(function(){a.error()})}}}]);