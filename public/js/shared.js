var sharedModule=angular.module("sharedModule",["ui.router","ngMaterial","ngMessages","infinite-scroll","chart.js","angularMoment","angularFileUpload"]);sharedModule.config(["$urlRouterProvider","$stateProvider","$mdThemingProvider",function(e,t,a){a.theme("default").primaryPalette("light-blue").accentPalette("pink"),a.theme("dark","default").primaryPalette("blue").dark(),e.otherwise("/page-not-found").when("","/"),t.state("page-not-found",{url:"/page-not-found",templateUrl:"/app/shared/views/page-not-found.view.html"}),a.theme("dark-orange").backgroundPalette("orange").dark(),a.theme("dark-teal").backgroundPalette("teal").dark()}]),sharedModule.controller("changePasswordDialogController",["$scope","$mdDialog","User","Preloader",function(e,t,a,n){e.password={},e.cancel=function(){t.cancel()},e.checkPassword=function(){a.checkPassword(e.password).success(function(t){e.match=t,e.show=!0})},e.submit=function(){if(e.showErrors=!0,e.changePasswordForm.$invalid)angular.forEach(e.changePasswordForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})});else{if(e.password.old==e.password["new"]||e.password["new"]!=e.password.confirm)return;e.busy=!0,a.changePassword(e.password).success(function(){n.stop()}).error(function(){n.error()})}}}]),sharedModule.controller("homePageController",["$scope",function(e){e.show=function(){angular.element(document.querySelector(".main-view")).removeClass("no-opacity")}}]),sharedModule.controller("sharedDashboardContentContainerController",["$scope","$filter","$state","$mdDialog","Preloader","Category","Client","Task",function(e,t,a,n,r,o,s,i){e.$on("refresh",function(){e.init(e.subheader.current.request)}),e.toolbar={},e.toolbar.childState="Dashboard",e.toolbar.getItems=function(a){var n=a?t("filter")(e.toolbar.items,a):e.toolbar.items;return n},e.toolbar.searchAll=!0,e.showSearchBar=function(){e.task.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.task.busy=!1,e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.searched&&(e.task.page=1,e.task.no_matches=!1,e.task.items=[],e.searched=!1,e.init(e.subheader.current.request))},e.searchUserInput=function(){e.isLoading=!0,e.task.show=!1,e.searched=!0,e.init(e.subheader.current.request,!0)};var c=function(t){e.subheader.current=t,e.toolbar.items=[],e.init(e.subheader.current.request)};e.subheader={},e.subheader.show=!0,e.subheader.sort=[{label:"File Name",type:"file_name",sortReverse:!1},{label:"Category",type:"category",sortReverse:!1},{label:"Delivery Date",type:"delivery_date",sortReverse:!1},{label:"Live Date",type:"live_date",sortReverse:!1},{label:"Recently added",type:"created_at",sortReverse:!1}],e.subheader.refresh=function(){e.isLoading=!0,e.task.show=!1,e.init(e.subheader.current.request)},e.subheader.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.subheader.setCategoryFilter=function(t){return e.categoryFilter==t?e.categoryFilter="":void(e.categoryFilter=t)},e.subheader.setClientFilter=function(t){return e.clientFilter==t?e.clientFilter="":void(e.clientFilter=t)};var l=function(t){var a={label:t.label,request:{withTrashed:!1,"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1},{relation:"reworks",withTrashed:!1}],whereBetween:{label:"updated_at",start:t.start,end:t.end},where:[{label:"status",condition:"=",value:"complete"}],paginate:100},menu:[{label:"Download",icon:"mdi-download",action:function(){n.show({controller:"downloadDialogController",templateUrl:"/app/shared/templates/dialogs/download-dialog.template.html",parent:angular.element(document.body),fullscreen:!0})}}],action:function(e){c(e)}};e.subheader.navs.push(a)},u=[{label:"Monday"},{label:"Tuesday"},{label:"Wednesday"},{label:"Thursday"},{label:"Friday"},{label:"Saturday"}],d=function(e){e=new Date(e);var t=e.getDay(),a=e.getDate()-t+(0==t?-6:1);return new Date(e.setDate(a))};e.fetchDays=function(t){var a=new Date(t);if(e.subheader.navs=[],angular.forEach(u,function(e,t){e.start=new Date,e.start.setDate(a.getDate()+t),e.end=new Date,e.end.setDate(e.start.getDate()+1),e.start=e.start.toDateString(),e.end=e.end.toDateString(),l(e)}),e.subheader.currentNavItem){e.subheader.currentNavItem=e.today.getDay()?e.subheader.navs[e.today.getDay()-1].label:e.subheader.navs[5].label;var n=e.today.getDay()?e.subheader.navs[e.today.getDay()-1]:e.subheader.navs[5];c(n)}},e.date_start=d(new Date),e.fetchDays(e.date_start),e.mondaysOnly=function(e){var t=e.getDay();return 1===t},e.today=new Date;var f=function(t){t.first_letter=t.file_name.charAt(0).toUpperCase(),t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),t.delivery_date=new Date(t.delivery_date),t.live_date=new Date(t.live_date),t.deleted_at=t.deleted_at?new Date(t.deleted_at):null,t.category=t.category.name,t.client=t.client.name;var a={};a.display=t.file_name,("designer"!=e.user.role||t.reworks.length||t.designer_assigned.designer_id!=e.user.id)&&("quality_control"!=e.user.role||t.reworks.length||t.quality_control_assigned.quality_control_id!=e.user.id)?"admin"==e.user.role?(e.count++,e.toolbar.items.push(a)):"designer"==e.user.role&&t.reworks.length&&t.reworks[t.reworks.length-1].designer_id==e.user.id?(e.count++,e.toolbar.items.push(a)):"quality_control"==e.user.role&&t.reworks.length&&t.reworks[t.reworks.length-1].quality_control_id==e.user.id&&(e.count++,e.toolbar.items.push(a)):(e.count++,e.toolbar.items.push(a))};e.viewTask=function(e){a.go("main.task",{taskID:e})},e.init=function(t,a){o.index().success(function(t){e.categories=t}),s.index().success(function(t){e.clients=t}),e.task={},e.task.items=[],e.toolbar.items=[],e.count=0,a?t.searchText=e.toolbar.searchText:(e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.task.page=1,e.task.no_matches=!1,e.searched=!1,t.searchText=null),e.task.page=2,i.enlist(t).success(function(a){return a?(e.task.details=a,e.task.items=a.data,e.task.show=!0,a.data.length&&angular.forEach(a.data,function(e){f(e)}),void(e.task.paginateLoad=function(){return e.task.busy||e.task.page>e.task.details.last_page?void(e.isLoading=!1):(e.task.busy=!0,e.isLoading=!0,void i.enlist(t,e.task.page).success(function(t){e.task.page++,angular.forEach(t.data,function(t,a){f(t),e.task.items.push(t)}),e.task.busy=!1,e.isLoading=!1}))})):void(e.task.show=!0)})};var h=e.today.getDay()?e.subheader.navs[e.today.getDay()-1]:e.subheader.navs[5];e.subheader.currentNavItem=h.label,c(h)}]),sharedModule.controller("sharedMainViewController",["$scope","$state","$mdDialog","$mdSidenav","$mdToast","User","Preloader","Notification",function(e,t,a,n,r,o,s,i){e.toggleSidenav=function(e){n(e).toggle()},e.menu={},e.menu["static"]=[{state:"main",icon:"mdi-view-dashboard",label:"Dashboard"},{state:"main.upload",icon:"mdi-file-excel",label:"Sheets"},{state:"main.tracker",icon:"mdi-view-list",label:"Tracker"},{state:"main.notifications",icon:"mdi-bell",label:"Notifications"},{state:"main.settings",icon:"mdi-settings",label:"Settings"}],e.logout=function(){o.logout().success(function(){window.location.href="/"})},e.changePassword=function(){a.show({controller:"changePasswordDialogController",templateUrl:"/app/shared/templates/dialogs/change-password-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){r.show(r.simple().content("Password changed.").position("bottom right").hideDelay(3e3))})};var c=function(){o.check().success(function(t){l(t),e.user=t})},l=function(a){return angular.forEach(a.unread_notifications,function(a){a.first_letter=a.data.sender.name.charAt(0).toUpperCase(),a.sender=a.data.sender.name,a.created_at=new Date(a.created_at),"App\\Notifications\\TaskCreated"==a.type?(a.message="created a new task.",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\TaskUpdated"==a.type?(a.message="updated a task.",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\SpreadsheetCreated"==a.type?(a.message="created a new sheet.",a.action=function(a){i.markAsRead(a).success(function(a){l(a),e.user=a,t.go("main.tracker")})}):"App\\Notifications\\TaskAssignedToDesigner"==a.type?(a.message="assigned a task for "+a.data.attachment.designer.name+".",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\DesignerTaskStart"==a.type?(a.message="started to work on "+a.data.attachment.task.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\TaskDeleted"==a.type?(a.message="deleted a task.",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\DesignerTaskDecline"==a.type?(a.message="declined to work on "+a.data.attachment.task.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\ForQC"==a.type?(a.message="submitted a task for quality control.",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\QualityControlTaskStart"==a.type?(a.message="started to work on "+a.data.attachment.task.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})}):"App\\Notifications\\MarkAsComplete"==a.type?(a.message="marked "+a.data.attachment.file_name+" as complete.",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\TaskRework"==a.type?(a.message="marked "+a.data.attachment.file_name+" as rework.",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\NotifyComment"==a.type?(a.message="commented on a task on "+a.data.attachment.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.id})})}):"App\\Notifications\\DesignerRevisionStart"==a.type&&(a.message="started to revise "+a.data.attachment.task.file_name+".",a.action=function(n){i.markAsRead(n).success(function(n){l(n),e.user=n,t.go("main.task",{taskID:a.data.attachment.task_id})})})}),a};e.markAsRead=function(t){i.markAsRead(t).success(function(t){l(t),e.user=t})},e.markAllAsRead=function(){i.markAllAsRead().success(function(t){l(t),e.user=t})},o.check().success(function(t){l(t),e.user=t;var a=new Pusher("b4fe17042b61e0b10730",{encrypted:!0}),n={};n.admin=a.subscribe("admin"),n.user=a.subscribe("user."+e.user.id),n.user.bindings=[n.user.bind("App\\Events\\PusherTaskCreated",function(t){c();var a=t.sender.name+" created a new task.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherTaskUpdated",function(t){c();var a=t.sender.name+" updated a task.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherSpreadsheetCreated",function(t){c();var a=t.sender.name+" created a new sheet.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherTaskAssignedToDesigner",function(t){c();var a=t.sender.name+" assigned a task for "+t.data.name+".";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherDesignerTaskStart",function(t){c();var a=t.sender.name+" started to work on "+t.data.file_name+".";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherTaskDeleted",function(t){c();var a=t.sender.name+" deleted a task.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherDesignerTaskDecline",function(t){c();var a=t.sender.name+" declined to work on "+t.data.file_name+".";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherForQC",function(t){c();var a=t.sender.name+" submitted a task for quality control.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherQualityControlTaskStart",function(t){c();var a=t.sender.name+" started to work on "+t.data.file_name+".";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherMarkAsComplete",function(t){c();var a=t.sender.name+" marked "+t.data.file_name+" as complete.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherTaskRework",function(t){c();var a=t.sender.name+" marked "+t.data.file_name+" as rework.";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherNotifyComment",function(t){c();var a=t.sender.name+" commented on a task on "+t.data.file_name+".";s.newNotification(a),e.$broadcast("refresh")}),n.user.bind("App\\Events\\PusherDesignerRevisionStart",function(t){c();var a=t.sender.name+" started to revise "+t.data.file_name+".";s.newNotification(a),e.$broadcast("refresh")})]})}]),sharedModule.controller("sharedNotificationsContentContainerController",["$scope","$filter","$state","Preloader","Notification","User",function(e,t,a,n,r,o){e.$on("refresh",function(){e.init()}),e.toolbar={},e.toolbar.childState="Notifications",e.toolbar.getItems=function(a){e.showInactive=!0;var n=a?t("filter")(e.toolbar.items,a):e.toolbar.items;return n},e.showSearchBar=function(){e.notification.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.notification.busy=!1,e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem=""};var s=function(t){t.data=JSON.parse(t.data),t.first_letter=t.data.sender.name.charAt(0).toUpperCase(),t.sender=t.data.sender.name,t.created_at=new Date(t.created_at),"App\\Notifications\\TaskCreated"==t.type?(t.message="created a new task.",t.task_id=t.data.attachment.task_id):"App\\Notifications\\SpreadsheetCreated"==t.type?(t.message="created a new sheet.",t.task_id=t.data.attachment.id):"App\\Notifications\\TaskAssignedToDesigner"==t.type?(t.message="assigned a task for "+t.data.attachment.designer.name+".",t.task_id=t.data.attachment.task_id):"App\\Notifications\\DesignerTaskStart"==t.type?(t.message="started to work on "+t.data.attachment.task.file_name+".",t.task_id=t.data.attachment.task_id):"App\\Notifications\\TaskDeleted"==t.type?(t.message="deleted a task.",t.task_id=t.data.attachment.task_id):"App\\Notifications\\DesignerTaskDecline"==t.type?(t.message="declined to work on "+t.data.attachment.task.file_name+".",t.task_id=t.data.attachment.task_id):"App\\Notifications\\ForQC"==t.type?(t.message="submitted a task for quality control.",t.task_id=t.data.attachment.id):"App\\Notifications\\QualityControlTaskStart"==t.type?(t.message="started to work on "+t.data.attachment.task.file_name+".",t.task_id=t.data.attachment.task_id):"App\\Notifications\\MarkAsComplete"==t.type?(t.message="marked "+t.data.attachment.file_name+" as complete.",t.task_id=t.data.attachment.id):"App\\Notifications\\TaskRework"==t.type?(t.message="marked "+t.data.attachment.file_name+" as rework.",t.task_id=t.data.attachment.id):"App\\Notifications\\NotifyComment"==t.type?(t.message="commented on a task on "+t.data.attachment.file_name+".",t.task_id=t.data.attachment.id):"App\\Notifications\\DesignerRevisionStart"==t.type?(t.message="started to revise "+t.data.attachment.task.file_name+".",t.task_id=t.data.attachment.task_id):"App\\Notifications\\NotifyDesignerForNewTask"==t.type?(t.message="assigned a task for you.",t.task_id=t.data.attachment.task_id):"App\\Notifications\\NotifyDesignerForCompleteTask"==t.type?(t.message="marked your task "+t.data.attachment.file_name+" as complete.",t.task_id=t.data.attachment.id):"App\\Notifications\\NotifyComment"==t.type?(t.message="commented on your task on "+t.data.attachment.file_name+".",t.task_id=t.data.attachment.id):"App\\Notifications\\NotifyDesignerForTaskRework"==t.type&&(t.message="marked your task "+t.data.attachment.file_name+" as rework.",t.task_id=t.data.attachment.id);var a={display:t.sender,message:t.message,file_name:t.data.attachment.file_name?t.data.attachment.file_name:null};e.toolbar.items.push(a)};e.init=function(){var t={paginate:20};e.notification={},e.notification.items=[],e.toolbar.items=[],e.notification.page=2,r.paginate(t).success(function(a){return a?(e.notification.details=a,e.notification.items=a.data,e.notification.show=!0,e.showInactive=!1,a.data.length&&angular.forEach(a.data,function(e){s(e)}),void(e.notification.paginateLoad=function(){return e.notification.busy||e.notification.page>e.notification.details.last_page?void(e.isLoading=!1):(e.notification.busy=!0,e.isLoading=!0,void r.paginate(t,e.notification.page).success(function(t){e.notification.page++,angular.forEach(t.data,function(t,a){s(t),e.notification.items.push(t)}),e.notification.busy=!1,e.isLoading=!1}))})):void(e.notification.show=!0)})},e.init()}]),sharedModule.controller("sheetsContentContainerController",["$scope","$filter","$state","Preloader","Spreadsheet",function(e,t,a,n,r){e.toolbar={},e.toolbar.childState="Sheets",e.toolbar.getItems=function(a){e.showInactive=!0;var n=a?t("filter")(e.toolbar.items,a):e.toolbar.items;return n},e.showSearchBar=function(){e.sheet.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.sheet.busy=!1,e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.showInactive=!1,e.searched&&(e.sheet.page=1,e.sheet.no_matches=!1,e.sheet.items=[],e.searched=!1,e.init())},e.fab={},e.fab.icon="mdi-upload",e.fab.label="Upload",e.fab.action=function(){a.go("main.upload")},e.fab.show=!0,e.subheader={},e.subheader.show=!0,e.subheader.sort=[{label:"Tasks Number",type:"first_letter",sortReverse:!1},{label:"Recently added",type:"created_at",sortReverse:!1}],e.subheader.refresh=function(){e.isLoading=!0,e.sheet.show=!1,e.init()},e.subheader.toggleActive=function(){e.showInactive=!e.showInactive},e.subheader.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse};var o=function(e){e.updated_at=new Date(e.updated_at),e.first_letter=e.tasks.length};e.init=function(t){e.sheet={},e.sheet.items=[],e.searched&&(e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.sheet.page=1,e.sheet.no_matches=!1,e.searched=!1),e.sheet.page=2,r.paginate(t).success(function(a){e.sheet.details=a,e.sheet.items=a.data,e.sheet.show=!0,e.fab.show=!0,e.showInactive=!1,a.data.length&&angular.forEach(a.data,function(e){o(e)}),e.sheet.paginateLoad=function(){return e.sheet.busy||e.sheet.page>e.sheet.details.last_page?void(e.isLoading=!1):(e.sheet.busy=!0,e.isLoading=!0,void Setting.paginate(t,e.sheet.page).success(function(t){e.sheet.page++,angular.forEach(t.data,function(t,a){o(t),e.sheet.items.push(t)}),e.sheet.busy=!1,e.isLoading=!1}))}})},e.init()}]),sharedModule.controller("taskContentContainerController",["$scope","$mdDialog","$state","$stateParams","Preloader","Task","DesignerAssigned","Rework","QualityControlAssigned","Comment","User",function(e,t,a,n,r,o,s,i,c,l,u){var d=n.taskID;e.toolbar={},e.toolbar.hideSearchIcon=!0,e.comment={},e.comment.task_id=d,e.$on("refresh",function(){e.init()}),e.fab={},e.fab.label="Edit",e.fab.icon="mdi-pencil",e.fab.action=function(){r.set(d),t.show({controller:"editTaskDialogController",templateUrl:"/app/components/admin/templates/dialogs/create-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.init()},function(){})},e.start=function(){var t={title:"Start",message:"Start working on this task?",ok:"start",cancel:"cancel"};r.confirm(t).then(function(){r.preload(),s.start(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()})},function(){})},e.decline=function(){var t={title:"Decline task",message:"This task will be removed from the list.",ok:"Decline",cancel:"Cancel"};r.confirm(t).then(function(){r.preload(),s.decline(e.task).success(function(){r.stop(),a.go("main.tracker")}).error(function(){r.error()})})},e.forQC=function(){var t={message:"Submit task for quality control?",ok:"Continue",cancel:"Cancel"};e.task.reworks.length?t.title="For QC Revised":t.title="For QC",r.confirm(t).then(function(){r.preload(),e.task.reworks.length?i.forQC(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()}):s.forQC(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()})},function(){})},e.revision=function(){var t={title:"Revise",message:"Start revising this task?",ok:"Revise",cancel:"Cancel"};r.confirm(t).then(function(){r.preload(),i.revise(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()})},function(){})},e.pass=function(){var t={title:"Pass",message:"Have other people continue this revision?",ok:"Pass",cancel:"Cancel"};r.confirm(t).then(function(){r.preload(),i.pass(e.task).success(function(e){r.stop(),a.go("main.tracker")}).error(function(){r.error()})},function(){})},e.assign=function(){e.task.include=!0,r.set([e.task]),t.show({controller:"assignTasksDialogController",templateUrl:"/app/shared/templates/dialogs/assign-tasks-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.init()},function(){})},e.reassign=function(){e.task.include=!0,r.set(e.task),t.show({controller:"reassignTasksDialogController",templateUrl:"/app/shared/templates/dialogs/reassign-tasks-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.init()},function(){})},e["delete"]=function(){var e={title:"Delete task",message:"This task will be removed from the list.",ok:"Delete",cancel:"Cancel"};r.confirm(e).then(function(){r.preload(),o["delete"](d).success(function(){r.stop(),a.go("main.tracker")}).error(function(){r.error()})})},e.startQC=function(){var t={title:"Start",message:"Start working on this task?",ok:"start",cancel:"cancel"};r.confirm(t).then(function(){r.preload(),e.task.reworks.length?i.startQC(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()}):c.store(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()})},function(){})},e.complete=function(){var t={title:"Complete",message:"Mark this task as complete?",ok:"complete",cancel:"cancel"};r.confirm(t).then(function(){r.preload(),e.task.reworks.length?i.complete(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()}):c.complete(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()})},function(){})},e.rework=function(){var t={title:"Rework",placeholder:"Comment",message:"Tell "+e.task.designer_assigned.designer.name+" how can he improve his work.",ok:"comment",cancel:"cancel"};r.prompt(t).then(function(t){if(t){r.preload();var a={};a.task_id=d,a.message=t,e.task.quality_control_assigned.time_end&&(a.rework=!0),l.store(a).success(function(){e.task.quality_control_assigned.time_end?i.rework(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()}):c.rework(e.task).success(function(t){r.stop(),e.init()}).error(function(){r.error()})}).error(function(){r.error()})}},function(){})},e.submit=function(){e.comment.message&&(e.busy=!0,e.task.quality_control_assigned.time_end&&(e.comment.rework=!0),l.store(e.comment).success(function(t){e.comment.message=null,e.comment.rework=!1,e.init()}).error(function(){e.busy=!1,r.error()}))},e.init=function(){var t={withTrashed:!0,"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1,"with":[{relation:"designer",withTrashed:!0}]},{relation:"quality_control_assigned",withTrashed:!1,"with":[{relation:"quality_control",withTrashed:!0}]},{relation:"reworks",withTrashed:!1,"with":[{relation:"designer",withTrashed:!0},{relation:"quality_control",withTrashed:!0}]},{relation:"comments",withTrashed:!1,"with":[{relation:"user",withTrashed:!0}]}],where:[{label:"id",condition:"=",value:d}]};u.check().success(function(t){e.fab.show="designer"!=t.role}),o.enlist(t).success(function(t){e.unauthorized="designer"==e.user.role,t.designer_assigned&&(e.unauthorized=!1,t.designer_assigned.designer.id!=e.user.id&&"designer"==e.user.role&&(e.unauthorized=!0),t.designer_assigned.time_start=t.designer_assigned.time_start?new Date(t.designer_assigned.time_start):null,t.designer_assigned.time_end=t.designer_assigned.time_end?new Date(t.designer_assigned.time_end):null),t.quality_control_assigned&&(t.quality_control_assigned.quality_control.id!=e.user.id&&"quality_control"==e.user.role&&(e.unauthorized=!0),t.quality_control_assigned.time_start=t.quality_control_assigned.time_start?new Date(t.quality_control_assigned.time_start):null,t.quality_control_assigned.time_end=t.quality_control_assigned.time_end?new Date(t.quality_control_assigned.time_end):null),t.comments.length&&angular.forEach(t.comments,function(e){e.first_letter=e.user.name.charAt(0).toUpperCase(),e.created_at=new Date(e.created_at)}),t.reworks.length&&(e.under_qc=!1,e.under_revision=!1,angular.forEach(t.reworks,function(t){t.designer_time_start=t.designer_time_start?new Date(t.designer_time_start):null,t.designer_time_end=t.designer_time_end?new Date(t.designer_time_end):null,t.quality_control_time_start=t.quality_control_time_start?new Date(t.quality_control_time_start):null,t.quality_control_time_end=t.quality_control_time_end?new Date(t.quality_control_time_end):null,e.under_revision=!(!t.designer_time_start||t.designer_time_end),e.under_qc=!(!t.quality_control_time_start||t.quality_control_time_end)}),e.authorized_designer_id=t.reworks[t.reworks.length-1].designer_id?t.reworks[t.reworks.length-1].designer_id:e.user.id,e.authorized_quality_control_id=t.reworks[t.reworks.length-1].quality_control_id?t.reworks[t.reworks.length-1].quality_control_id:e.user.id),e.task=t,e.busy=!1,e.task.first_letter=t.file_name.charAt(0).toUpperCase(),e.task.category=t.category.name,e.task.client=t.client.name,e.toolbar.childState=t.file_name}).error(function(){r.error()})},e.init()}]),sharedModule.controller("trackerContentContainerController",["$scope","$state","$filter","$timeout","$mdDialog","$mdToast","$mdBottomSheet","$mdMedia","Preloader","Category","Client","Task","User",function(e,t,a,n,r,o,s,i,c,l,u,d,f){e.toolbar={},e.toolbar.childState="Tracker",e.toolbar.getItems=function(t){e.showInactive=!0;var n=t?a("filter")(e.toolbar.items,t):e.toolbar.items;return n},e.toolbar.searchAll=!0,e.$on("refresh",function(){e.init(e.subheader.current.request)}),e.showSearchBar=function(){e.task.busy=!0,e.searchBar=!0},e.hideSearchBar=function(){e.task.busy=!1,e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.showInactive=!1,e.searched&&(e.task.page=1,e.task.no_matches=!1,e.task.items=[],e.searched=!1,e.init(e.subheader.current.request))},e.searchUserInput=function(){e.isLoading=!0,e.task.show=!1,e.searched=!0,e.init(e.subheader.current.request,!0)};var h=function(){r.show({controller:"createTasksDialogController",templateUrl:"/app/components/admin/templates/dialogs/create-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(t){e.task.busy=!0;var a="A new task has been created.";c.notify(a).then(function(){e.task.busy=!1,e.subheader.refresh()})},function(){})};e.fab={},e.fab.icon="mdi-plus",e.fab.label="Task",e.fab.action=h;var m=function(t){e.subheader.current=t,e.toolbar.items=[],e.init(e.subheader.current.request)};e.subheader={},e.subheader.show=!0,e.subheader.navs=[{label:"Pending",request:{withTrashed:!0,"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1}],where:[{label:"status",condition:"=",value:"pending"}],paginate:20},action:function(e){m(e)},menu:[{label:"Assign multiple",icon:"mdi-tag-multiple",action:function(){e.selectMultiple=!0,e.fab.label="Assign",e.fab.icon=this.icon,e.fab.action=function(){c.set(e.task.items),r.show({controller:"assignTasksDialogController",templateUrl:"/app/shared/templates/dialogs/assign-tasks-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectMultiple=!1,e.fab.label="Task",e.fab.icon="mdi-plus",e.fab.action=h,e.subheader.refresh()})}}}]},{label:"In Progress",request:{"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1},{relation:"reworks",withTrashed:!1,"with":[{relation:"designer",withTrashed:!0},{relation:"quality_control",withTrashed:!0}]}],where:[{label:"status",condition:"=",value:"in_progress"}],paginate:20},action:function(e){m(e)},menu:[{label:"Batch Complete",icon:"mdi-check",action:function(){e.selectForQC=!0,e.fab.label="Batch Complete",e.fab.icon=this.icon,e.fab.action=function(){c.set(e.task.items),r.show({controller:"batchCompleteDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectForQC=!1,e.fab.label="Task",e.fab.icon="mdi-plus",e.fab.action=h,e.subheader.refresh()})}}},{label:"Batch Rework",icon:"mdi-repeat",action:function(){e.selectForQC=!0,e.fab.label="Batch Rework",e.fab.icon=this.icon,e.fab.action=function(){c.set(e.task.items),r.show({controller:"batchReworkDialogController",templateUrl:"/app/shared/templates/dialogs/batch-rework-tasks-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectForQC=!1,e.fab.label="Task",e.fab.icon="mdi-plus",e.fab.action=h,e.subheader.refresh()})}}}]},{label:"For QC",request:{"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1},{relation:"reworks",withTrashed:!1,"with":[{relation:"designer",withTrashed:!0},{relation:"quality_control",withTrashed:!0}]}],where:[{label:"status",condition:"=",value:"for_qc"}],paginate:20},action:function(e){m(e)},menu:[{label:"Batch Start QC",icon:"mdi-timer",action:function(){e.selectForQC=!0,e.fab.label="Start QC",e.fab.icon=this.icon,e.fab.action=function(){c.set(e.task.items),r.show({controller:"batchStartQCDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectForQC=!1,e.fab.label="Task",e.fab.icon="mdi-plus",e.fab.action=h,e.subheader.refresh()})}}},{label:"Batch QC Start Revised",icon:"mdi-timelapse",action:function(){e.selectRework=!0,e.fab.label="QC Start Revised",e.fab.icon=this.icon,e.fab.action=function(){c.set(e.task.items),r.show({controller:"batchQCStartRevisedDialogController",templateUrl:"/app/shared/templates/dialogs/batch-action-task-dialog.template.html",parent:angular.element(document.body),fullscreen:!0}).then(function(){e.selectRework=!1,e.fab.label="Task",e.fab.icon="mdi-plus",e.fab.action=h,e.subheader.refresh()})}}}]},{label:"Rework",request:{"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1}],where:[{label:"status",condition:"=",value:"rework"}],paginate:20},action:function(e){m(e)}},{label:"Complete",request:{"with":[{relation:"category",withTrashed:!0},{relation:"client",withTrashed:!0},{relation:"designer_assigned",withTrashed:!1},{relation:"quality_control_assigned",withTrashed:!1}],where:[{label:"status",condition:"=",value:"complete"}],paginate:20},action:function(e){m(e)}}],e.subheader.sort=[{label:"File Name",type:"file_name",sortReverse:!1},{label:"Category",type:"category",sortReverse:!1},{label:"Delivery Date",type:"delivery_date",sortReverse:!1},{label:"Live Date",type:"live_date",sortReverse:!1},{label:"Recently added",type:"created_at",sortReverse:!1
}],e.subheader.mark={},e.subheader.toggleMark=function(){e.subheader.mark.all=!e.subheader.mark.all,e.subheader.mark.icon=e.subheader.mark.all?"mdi-checkbox-marked":"mdi-checkbox-blank-outline",e.subheader.mark.label=e.subheader.mark.all?"Uncheck all":"Check all",angular.forEach(e.task.items,function(t){t.include=e.subheader.mark.all})},e.subheader.cancelSelectMultiple=function(){e.selectMultiple=!1,e.selectForQC=!1,e.selectRework=!1,e.fab.label="Task",e.fab.icon="mdi-plus",e.fab.action=h,e.subheader.mark.all=!1,e.subheader.mark.icon="mdi-checkbox-blank-outline",e.subheader.mark.label="Check all",angular.forEach(e.task.items,function(e){e.include=!1})},e.subheader.refresh=function(){e.isLoading=!0,e.task.show=!1,e.init(e.subheader.current.request)},e.subheader.toggleActive=function(){e.showInactive=!e.showInactive},e.subheader.sortBy=function(t){t.sortReverse=!t.sortReverse,e.sortType=t.type,e.sortReverse=t.sortReverse},e.subheader.setCategoryFilter=function(t){return e.categoryFilter==t?e.categoryFilter="":void(e.categoryFilter=t)},e.subheader.setClientFilter=function(t){return e.clientFilter==t?e.clientFilter="":void(e.clientFilter=t)},e.rightSidenav={},e.rightSidenav.show=!1;var g=function(t){t.first_letter=t.file_name.charAt(0).toUpperCase(),t.created_at=new Date(t.created_at),t.updated_at=new Date(t.updated_at),t.delivery_date=new Date(t.delivery_date),t.live_date=new Date(t.live_date),t.deleted_at=t.deleted_at?new Date(t.deleted_at):null,t.category=t.category.name,t.client=t.client.name;var a={};a.display=t.file_name,e.toolbar.items.push(a)};e.init=function(t,a){e.selectMultiple=!1,e.selectForQC=!1,e.selectRework=!1,e.subheader.mark.all=!1,e.subheader.mark.icon="mdi-checkbox-blank-outline",e.subheader.mark.label="Check all",l.index().success(function(t){e.categories=t}),u.index().success(function(t){e.clients=t}),e.task={},e.task.items=[],e.toolbar.items=[],a?t.searchText=e.toolbar.searchText:(e.searchBar=!1,e.toolbar.searchText="",e.toolbar.searchItem="",e.task.page=1,e.task.no_matches=!1,e.searched=!1,t.searchText=null),e.task.page=2,d.enlist(t).success(function(a){return a?(e.task.details=a,e.task.items=a.data,e.task.show=!0,e.fab.show=!0,e.showInactive=!1,a.data.length&&angular.forEach(a.data,function(e){g(e)}),void(e.task.paginateLoad=function(){return e.task.busy||e.task.page>e.task.details.last_page?void(e.isLoading=!1):(e.task.busy=!0,e.isLoading=!0,void d.enlist(t,e.task.page).success(function(t){e.task.page++,angular.forEach(t.data,function(t,a){g(t),e.task.items.push(t)}),e.task.busy=!1,e.isLoading=!1}))})):void(e.task.show=!0)})},e.subheader.currentNavItem=e.subheader.navs[0].label,m(e.subheader.navs[0])}]),sharedModule.controller("uploadContentContainerController",["$scope","$filter","$mdDialog","$state","FileUploader","Preloader","Spreadsheet","Task",function(e,t,a,n,r,o,s,i){e.toolbar={},e.form={},e.toolbar.items=[],e.toolbar.childState="Upload Sheet",e.toolbar.getItems=function(a){e.showInactive=!0;var n=a?t("filter")(e.toolbar.items,a):e.toolbar.items;return n},e.showSearchBar=function(){e.searchBar=!0},e.hideSearchBar=function(){e.toolbar.searchText="",e.toolbar.searchItem="",e.searchBar=!1},e.fab={},e.fab.icon="mdi-check",e.fab.label="Upload";var c={};c.filter={name:"excelFilter",fn:function(e,t){var a="|"+e.type.slice(e.type.lastIndexOf("/")+1)+"|";return"|vnd.openxmlformats-officedocument.spreadsheetml.sheet|vnd.ms-excel|".indexOf(a)!==-1}},c.error=function(t,a,n){e.fileError=!0,e.excelUploader.queue=[]},c.headers={"X-CSRF-TOKEN":document.querySelector('meta[name="csrf-token"]').getAttribute("content")},e.excelUploader=new r({url:"/spreadsheet",headers:c.headers,queueLimit:1}),e.excelUploader.filters.push(c.filter),e.excelUploader.onWhenAddingFileFailed=c.error,e.excelUploader.onAfterAddingFile=function(){e.fileError=!1,e.excelUploader.queue.length&&e.excelUploader.uploadAll()},e.checkDuplicate=function(t){var a=!0,n=e.tasks.indexOf(t),r=!1;return angular.forEach(e.tasks,function(e,o){a&&o!=n&&t.file_name==e.file_name&&(r=!0,a=!1)}),r?t.duplicate=!0:(t.duplicate=!1,void o.checkDuplicate("task",t).success(function(e){t.duplicate=e}))},e.remove=function(t){var n=a.confirm().title("Remove").textContent("Remove "+t.file_name+" from the list?").ariaLabel("Remove").ok("Remove").cancel("Cancel");a.show(n).then(function(){var a=e.tasks.indexOf(t);e.tasks.splice(a,1)},function(){})};var l=function(t){angular.forEach(t,function(a,n){var r=!0;angular.forEach(t,function(e,t){r&&n!=t&&a.file_name==e.file_name&&(a.duplicate=!0,r=!1)}),a.delivery_date=new Date(a.delivery_date),a.live_date=new Date(a.live_date),e.tasks.push(a);var o={};o.display=a.file_name,e.toolbar.items.push(o)})};e.excelUploader.onCompleteItem=function(t,a){s.read(a.id).success(function(t){e.tasks=[],Array.isArray(t[0])?angular.forEach(t,function(t){angular.forEach(t,function(t){t.spreadsheet_id=a.id,e.tasks.push(t)})}):angular.forEach(t,function(t){t.spreadsheet_id=a.id,e.tasks.push(t)}),i.checkDuplicateMultiple(e.tasks).success(function(t){l(t),e.tasks=t,e.show=!0}).error(function(){o.error()}),e.fab.show=!0}).error(function(){o.error()})};var u=!1;e.fab.action=function(){var t=!1;return e.form.taskForm.$invalid?void angular.forEach(e.form.taskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):(angular.forEach(e.tasks,function(e){e.duplicate&&(o.alert("Duplicate File Name",e.file_name+" already exists."),t=!0)}),void(u||t||(u=!0,o.preload(),angular.forEach(e.tasks,function(e){e.delivery_date=new Date(e.delivery_date),e.live_date=new Date(e.live_date)}),i.storeMultiple(e.tasks).success(function(e){u=!1,o.stop(),n.go("main.tracker")}).error(function(){o.error()}))))}}]),sharedModule.service("Preloader",["$mdDialog","$mdToast","$http",function(e,t,a){var n=null;return{prompt:function(t){var a=e.prompt().title(t.title).textContent(t.message).placeholder(t.placeholder).ariaLabel(t.title).ok(t.ok).cancel(t.cancel);return e.show(a)},confirm:function(t){var a=e.confirm().title(t.title).textContent(t.message).ariaLabel(t.title).ok(t.ok).cancel(t.cancel);return e.show(a)},alert:function(t,a){e.show(e.alert().parent(angular.element($("body"))).clickOutsideToClose(!0).title(t).textContent(a).ariaLabel(t).ok("Got it!"))},newNotification:function(e,a){var n=t.simple().textContent(e).action(a).highlightAction(!0).highlightClass("md-primary").position("bottom right");return t.show(n)},notify:function(e){return t.show(t.simple().textContent(e).position("bottom right").hideDelay(3e3))},preload:function(){return e.show({templateUrl:"/app/shared/views/loading.html",parent:angular.element(document.body)})},stop:function(t){return e.hide(t)},error:function(){return e.show(e.alert().parent(angular.element($("body"))).clickOutsideToClose(!0).title("Oops! Something went wrong!").content("An error occured. Please contact administrator for assistance.").ariaLabel("Error Message").ok("Got it!"))},set:function(e){n=e},get:function(){return n},checkDuplicate:function(e,t){return a.post(e+"/check-duplicate",t)}}}]),sharedModule.service("Setting",["$http","$mdToast",function(e,t){return{paginate:function(t,a){var n="Categories"==t?"category":"Clients"==t?"client":"Designers"==t?"user/designers":"user/quality_control";return e.post(n+"/paginate?page="+a)},search:function(t,a){var n="Categories"==t?"category/enlist":"Clients"==t?"client/enlist":"user/enlist";return e.post(n,a)},settingController:function(e,t){return t=t.replace(/\s/g,""),e+t+"DialogController"},settingDialogTemplate:function(e,t){return"Designers"==t||"Quality Control"==t?e+"-users-dialog.template.html":(t=t.replace(/\s+/g,"-").toLowerCase(),e+"-"+t+"-dialog.template.html")},fabCreateSuccessMessage:function(e){if("Categories"==e)var a="A new category has been added.";else if("Clients"==e)var a="A new client has been added.";else if("Designers"==e)var a="A new designer has been added to your team.";else if("Quality Control"==e)var a="A new quality control has been added to your team.";return t.show(t.simple().textContent(a).position("bottom right").hideDelay(3e3))},"delete":function(t,a){var n="Categories"==t?"category":"client";return e["delete"](n+"/"+a.id)}}}]),sharedModule.factory("Category",["$http",function(e){var t="/category";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},checkDuplicate:function(a){return e.post(t+"/check-duplicate",a)}}}]),sharedModule.factory("Client",["$http",function(e){var t="/client";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)}}}]),sharedModule.factory("Comment",["$http",function(e){var t="/comment";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)}}}]),sharedModule.factory("DesignerAssigned",["$http",function(e){var t="/designer-assigned";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},paginate:function(a,n){return e.post(t+"/paginate?page="+n,a)},start:function(a){return e.post(t+"/start",a)},decline:function(a){return e.post(t+"/decline",a)},forQC:function(a){return e.post(t+"/for-qc",a)}}}]),sharedModule.factory("Notification",["$http",function(e){var t="/notification";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},markAsRead:function(a){return e.post(t+"/mark-as-read/"+a)},markAllAsRead:function(){return e.post(t+"/mark-all-as-read")},paginate:function(a,n){return n?e.post(t+"/paginate?page="+n,a):e.post(t+"/paginate",a)}}}]),sharedModule.factory("QualityControlAssigned",["$http",function(e){var t="/quality-control-assigned";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},complete:function(a){return e.post(t+"/complete",a)},rework:function(a){return e.post(t+"/rework",a)}}}]),sharedModule.factory("QualityControlTask",["$http",function(e){var t="/quality-control-task";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)}}}]),sharedModule.factory("Rework",["$http",function(e){var t="/rework";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},revise:function(a){return e.post(t+"/revise",a)},forQC:function(a){return e.post(t+"/for-qc",a)},startQC:function(a){return e.post(t+"/start-qc",a)},complete:function(a){return e.post(t+"/complete",a)},pass:function(a){return e.post(t+"/pass",a)},rework:function(a){return e.post(t+"/rework",a)}}}]),sharedModule.factory("Spreadsheet",["$http",function(e){var t="/spreadsheet";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},read:function(a){return e.get(t+"/read/"+a)},paginate:function(a,n){return e.post(t+"/paginate?page="+n,a)}}}]),sharedModule.factory("Task",["$http",function(e){var t="/task";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},paginate:function(a,n){return n?e.post(t+"/paginate?page="+n,a):e.post(t+"/paginate",a)},storeMultiple:function(a){return e.post(t+"/store-multiple",a)},checkDuplicateMultiple:function(a){return e.post(t+"/check-duplicate-multiple",a)},enlist:function(a,n){return n?e.post(t+"/enlist?page="+n,a):e.post(t+"/enlist",a)}}}]),sharedModule.factory("User",["$http",function(e){var t="/user";return{index:function(){return e.get(t)},show:function(a){return e.get(t+"/"+a)},store:function(a){return e.post(t,a)},update:function(a,n){return e.put(t+"/"+a,n)},"delete":function(a){return e["delete"](t+"/"+a)},check:function(a){return e.post(t+"/check",a)},logout:function(){return e.post(t+"/logout")},checkEmail:function(a){return e.post(t+"/check-email",a)},checkPassword:function(a){return e.post(t+"/check-password",a)},changePassword:function(a){return e.post(t+"/change-password",a)},resetPassword:function(a){return e.post(t+"/reset-password",a)},paginate:function(a){return e.get(t+"/paginate?page="+a)},disable:function(a){return e.post(t+"/disable",a)},markAsRead:function(a){return e.get(t+"/mark-as-read/"+a)},enlist:function(a){return e.post(t+"/enlist",a)},pending:function(){return e.post(t+"/pending")}}}]),sharedModule.controller("itemActionsBottomSheetController",["$scope","$mdBottomSheet","Preloader",function(e,t,a){e.type=a.get(),e.action=function(e){t.hide(e)}}]),sharedModule.controller("assignTasksDialogController",["$scope","$mdDialog","Preloader","User","DesignerAssigned",function(e,t,a,n,r){e.tasks=a.get(),e.busy=!1,e.cancel=function(){t.cancel()},e.setDesigner=function(){angular.forEach(e.tasks,function(t,a){t.include&&(t.designer_id=e.designer)})};var o={where:[{label:"role",condition:"=",value:"designer"}]};n.enlist(o).success(function(t){e.users=t}),e.submit=function(){return e.assignTaskForm.$invalid?void angular.forEach(e.assignTaskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.busy||(e.busy=!0,e.instructions&&angular.forEach(e.tasks,function(t){t.instructions=e.instructions}),r.store(e.tasks).success(function(){a.stop()}).error(function(){a.error()})))}}]),sharedModule.controller("batchCompleteDialogController",["$scope","$mdDialog","Preloader","QualityControlAssigned","Rework",function(e,t,a,n,r){e.tasks=a.get(),e.busy=!1,e.label="Batch Complete",e.action="Complete",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.reworks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&!e.reworks.length?t.tasks.push(e):e.include&&e.reworks.length&&t.reworks.push(e)}),t.tasks.length&&n.complete(t).success(function(){a.stop()}).error(function(){a.error()}),t.reworks.length&&r.complete(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),sharedModule.controller("batchQCStartRevisedDialogController",["$scope","$mdDialog","Preloader","Rework",function(e,t,a,n){e.tasks=a.get(),e.busy=!1,e.label="Batch QC Start Revised",e.action="QC Start Revised",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),n.startQC(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),sharedModule.controller("batchReworkDialogController",["$scope","$mdDialog","Preloader","Comment","QualityControlAssigned","Rework",function(e,t,a,n,r,o){e.tasks=a.get(),e.comment={},e.busy=!1,e.label="Batch Rework",e.action="Rework",e.cancel=function(){t.cancel()},e.submit=function(){if(e.reworkTaskForm.$invalid)return void angular.forEach(e.reworkTaskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})});if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.first_rework=[],t.rework_again=[],t.batch=!0,angular.forEach(e.tasks,function(a){a.include&&(a.message=e.comment.message,a.quality_control_assigned.time_end?(a.rework=!0,t.rework_again.push(a)):t.first_rework.push(a),t.tasks.push(a))}),n.store(t).success(function(){t.first_rework.length&&r.rework(t).success(function(){a.stop()}).error(function(){a.error()}),t.rework_again.length&&o.rework(t).success(function(){a.stop()}).error(function(){a.error()})})}}}]),sharedModule.controller("batchStartQCDialogController",["$scope","$mdDialog","Preloader","QualityControlAssigned",function(e,t,a,n){e.tasks=a.get(),e.busy=!1,e.label="Batch For QC",e.action="For QC",e.cancel=function(){t.cancel()},e.submit=function(){if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),n.store(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),sharedModule.controller("createCategoriesDialogController",["$scope","$mdDialog","Preloader","Category",function(e,t,a,n){var r="category";e.category={},e.busy=!1,e.duplicate=!1,e.checkDuplicate=function(){a.checkDuplicate(r,e.category).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.categoryForm.$invalid?void angular.forEach(e.categoryForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.duplicate||(e.busy=!0,n.store(e.category).success(function(t){return t?void(e.busy=!1):void a.stop()}).error(function(){a.error()})))}}]),sharedModule.controller("createClientsDialogController",["$scope","$mdDialog","Preloader","Client",function(e,t,a,n){var r="client";e.client={},e.busy=!1,e.duplicate=!1,e.checkDuplicate=function(){a.checkDuplicate(r,e.client).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.clientForm.$invalid?void angular.forEach(e.clientForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.duplicate||(e.busy=!0,n.store(e.client).success(function(t){return t?void(e.busy=!1):void a.stop()}).error(function(){a.error()})))}}]),sharedModule.controller("createTasksDialogController",["$scope","$mdDialog","Preloader","Category","Client","Task",function(e,t,a,n,r,o){var s="task";e.task={},e.task.delivery_date=new Date,e.task.live_date=new Date,e.busy=!1,e.duplicate=!1,n.index().success(function(t){e.categories=t}),r.index().success(function(t){e.clients=t}),e.checkDuplicate=function(){a.checkDuplicate(s,e.task).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.taskForm.$invalid?void angular.forEach(e.taskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.duplicate||(e.busy=!0,e.task.delivery_date=e.task.delivery_date.toDateString(),e.task.live_date=e.task.live_date.toDateString(),o.store(e.task).success(function(t){return"boolean"==typeof t?void(e.busy=!1):void a.stop(t)}).error(function(){a.error()})))}}]),sharedModule.controller("downloadDialogController",["$scope","$mdDialog","$filter",function(e,t,a){e.date={},e.date.start=new Date,e.date.end=new Date,e.today=new Date,e.cancel=function(){t.cancel()},e.submit=function(){if(e.downloadForm.$invalid)angular.forEach(e.downloadForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})});else{var t=window.open("/spreadsheet-download/"+a("date")(e.date.start,"yyyy-MM-dd")+"/to/"+a("date")(e.date.end,"yyyy-MM-dd"),"_blank");t.focus()}e.cancel()}}]),sharedModule.controller("editCategoriesDialogController",["$scope","$mdDialog","Preloader","Category",function(e,t,a,n){var r="category";n.show(a.get().id).success(function(t){e.category=t,e.label=t.name}),e.busy=!1,e.duplicate=!1,e.checkDuplicate=function(){a.checkDuplicate(r,e.category).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.categoryForm.$invalid?void angular.forEach(e.categoryForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.duplicate||(e.busy=!0,n.update(e.category.id,e.category).success(function(t){return t?void(e.busy=!1):void a.stop()}).error(function(){a.error()})))}}]),sharedModule.controller("editClientsDialogController",["$scope","$mdDialog","Preloader","Client",function(e,t,a,n){var r="client";n.show(a.get().id).success(function(t){e.client=t,e.label=t.name}),e.busy=!1,e.duplicate=!1,e.checkDuplicate=function(){a.checkDuplicate(r,e.client).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.clientForm.$invalid?void angular.forEach(e.clientForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.duplicate||(e.busy=!0,n.update(e.client.id,e.client).success(function(t){return t?void(e.busy=!1):void a.stop()}).error(function(){a.error()})))}}]),sharedModule.controller("editTaskDialogController",["$scope","$mdDialog","Preloader","Category","Client","Task",function(e,t,a,n,r,o){var s="task",i=a.get();e.busy=!1,e.duplicate=!1,o.show(i).success(function(t){t.delivery_date=new Date(t.delivery_date),t.live_date=new Date(t.live_date),e.task=t}),n.index().success(function(t){e.categories=t}),r.index().success(function(t){e.clients=t}),e.checkDuplicate=function(){a.checkDuplicate(s,e.task).success(function(t){e.duplicate=t})},e.cancel=function(){t.cancel()},e.submit=function(){return e.taskForm.$invalid?void angular.forEach(e.taskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.duplicate||(e.busy=!0,e.task.delivery_date=e.task.delivery_date.toDateString(),e.task.live_date=e.task.live_date.toDateString(),o.update(i,e.task).success(function(t){return"boolean"==typeof t?void(e.busy=!1):void a.stop(t)}).error(function(){a.error()})))}}]),sharedModule.controller("itemActionsDialogController",["$scope","$mdDialog","Preloader",function(e,t,a){e.type=a.get(),e.action=function(e){t.hide(e)}}]),sharedModule.controller("reassignTasksDialogController",["$scope","$mdDialog","Preloader","User","DesignerAssigned","Rework",function(e,t,a,n,r,o){e.task=a.get(),e.designer=e.task.designer_assigned.designer.id,e.busy=!1,e.cancel=function(){t.cancel()},e.setDesigner=function(){e.task.designer_id=e.designer};var s={where:[{label:"role",condition:"=",value:"designer"}]};n.enlist(s).success(function(t){e.users=t}),e.submit=function(){return e.assignTaskForm.$invalid?void angular.forEach(e.assignTaskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})}):void(e.busy||(e.busy=!0,"rework"!=e.task.status?r.update(e.task.id,e.task).success(function(){a.stop()}).error(function(){a.error()}):o.store(e.task).success(function(){a.stop()}).error(function(){a.error()})))}}]),sharedModule.controller("batchReworkTasksDialogController",["$scope","$mdDialog","Preloader","QualityControlAssigned","Comment",function(e,t,a,n,r){e.tasks=a.get(),e.comment={},e.busy=!1,e.cancel=function(){t.cancel()},e.submit=function(){if(e.reworkTaskForm.$invalid)return void angular.forEach(e.reworkTaskForm.$error,function(e){angular.forEach(e,function(e){e.$setTouched()})});if(!e.busy){e.busy=!0;var t={};t.tasks=[],t.batch=!0,angular.forEach(e.tasks,function(e){e.include&&t.tasks.push(e)}),r.store(t).success(function(){}),n.rework(t).success(function(){a.stop()}).error(function(){a.error()})}}}]),sharedModule.controller("customNotificationToastController",["$scope","$mdToast","$state","Preloader","Notification",function(e,t,a,n,r){e.notification=n.get(),e.notification.first_letter=e.notification.sender.name.charAt(0).toUpperCase(),e.notification.sender=e.notification.sender.name,e.notification.created_at=new Date(e.notification.data.created_at)}]);